<ion-content class="ion-padding">
  <div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <div class="welcome-section">
          <h1>Admin Dashboard</h1>
          <p class="welcome-message">Welcome back, {{ currentUser?.email }}!</p>
          <div class="user-info">
            <ion-chip class="admin-chip" *ngIf="currentUser?.userRole === 'Admin'">
              <ion-icon name="shield-checkmark-outline"></ion-icon>
              <ion-label>Admin</ion-label>
            </ion-chip>
            <ion-chip class="moderator-chip" *ngIf="currentUser?.userRole === 'Moderator'">
              <ion-icon name="shield-outline"></ion-icon>
              <ion-label>Moderator</ion-label>
            </ion-chip>
            <ion-chip class="verified-chip" *ngIf="currentUser?.emailVerified">
              <ion-icon name="checkmark-circle-outline"></ion-icon>
              <ion-label>Verified</ion-label>
            </ion-chip>
          </div>
        </div>
        <div class="header-actions">
          <ion-button fill="outline" (click)="logout()" class="logout-button">
            <ion-icon name="log-out-outline" slot="start"></ion-icon>
            Logout
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="people-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <h3>Users</h3>
          <p class="stat-number">{{ stats.totalUsers || 0 }}</p>
          <p class="stat-label">Total Registered</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="mail-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <h3>Messages</h3>
          <p class="stat-number">{{ stats.totalMessages || 0 }}</p>
          <p class="stat-label">Contact Form</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="newspaper-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <h3>Newsletter</h3>
          <p class="stat-number">{{ stats.newsletterSubscribers || 0 }}</p>
          <p class="stat-label">Subscribers</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <ion-icon name="analytics-outline"></ion-icon>
        </div>
        <div class="stat-content">
          <h3>Views</h3>
          <p class="stat-number">{{ stats.totalViews || 0 }}</p>
          <p class="stat-label">This Month</p>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="content-grid">
      <!-- Quick Actions -->
      <div class="content-card">
        <div class="card-header">
          <ion-icon name="flash-outline"></ion-icon>
          <h3>Quick Actions</h3>
        </div>
        <div class="card-content">
          <div class="action-buttons">
            <ion-button expand="block" fill="outline" class="action-btn" (click)="navigateToCreateContent()" *ngIf="isFullAdmin()">
              <ion-icon name="create-outline" slot="start"></ion-icon>
              Create Content
            </ion-button>
            <ion-button expand="block" fill="outline" class="action-btn" (click)="navigateToArchiveContent()" *ngIf="isFullAdmin()">
              <ion-icon name="archive-outline" slot="start"></ion-icon>
              Archive Content
            </ion-button>
            <ion-button expand="block" fill="outline" class="action-btn" (click)="navigateToManageContent()" *ngIf="isFullAdmin()">
              <ion-icon name="document-text-outline" slot="start"></ion-icon>
              Manage Content
            </ion-button>
            <ion-button expand="block" fill="outline" class="action-btn" (click)="navigateToYouTubeSettings()">
              <ion-icon name="logo-youtube" slot="start"></ion-icon>
              Youtube Settings
            </ion-button>
            <!-- <ion-button expand="block" fill="outline" class="action-btn">
              <ion-icon name="chatbubbles-outline" slot="start"></ion-icon>
              Comments Settings
            </ion-button> -->
            <ion-button expand="block" fill="outline" class="action-btn" (click)="navigateToUserManagement()" *ngIf="isFullAdmin()">
              <ion-icon name="people-outline" slot="start"></ion-icon>
              User Management
            </ion-button>
            <ion-button expand="block" fill="outline" class="action-btn" (click)="navigateToEmergencyControls()" *ngIf="isFullAdmin()">
              <ion-icon name="settings-outline" slot="start"></ion-icon>
              Site Management
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="content-card">
        <div class="card-header">
          <ion-icon name="time-outline"></ion-icon>
          <h3>Recent Activity</h3>
        </div>
        <div class="card-content">
          <div class="activity-list">
            <div class="activity-item" *ngFor="let activity of recentActivity">
              <div class="activity-icon">
                <ion-icon [name]="activity.icon"></ion-icon>
              </div>
              <div class="activity-content">
                <p class="activity-text">{{ activity.text }}</p>
                <p class="activity-time">{{ activity.time }}</p>
              </div>
            </div>
            <div *ngIf="recentActivity.length === 0" class="no-activity">
              <ion-icon name="time-outline"></ion-icon>
              <p>No recent activity</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Overall Usage -->
      <div class="content-card">
        <div class="card-header">
          <ion-icon name="pie-chart-outline"></ion-icon>
          <h3>Overall Usage</h3>
        </div>
        <div class="card-content">
          <div class="usage-list">
            <!-- Storage Usage -->
            <div class="usage-item">
              <div class="usage-header">
                <div class="usage-info">
                  <span class="usage-label">Storage</span>
                  <span class="usage-details">{{ formatBytes(stats.storageUsedBytes) }} / {{ formatBytes(stats.storageLimitBytes) }}</span>
                </div>
                <ion-chip [color]="stats.storagePercentUsed >= 80 ? 'warning' : 'primary'" size="small">
                  <ion-label>{{ stats.storagePercentUsed | number:'1.0-0' }}%</ion-label>
                </ion-chip>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar-fill" [style.width.%]="capPercentage(stats.storagePercentUsed)" [class.warning]="stats.storagePercentUsed >= 80" [class.danger]="stats.storagePercentUsed >= 95"></div>
              </div>
              <div class="usage-footer">
                <span class="usage-free-tier">Free tier: {{ formatBytes(stats.storageLimitBytes) }}</span>
              </div>
            </div>

            <!-- Firestore Usage -->
            <div class="usage-item" *ngIf="stats.firestoreUsedBytes !== null">
              <div class="usage-header">
                <div class="usage-info">
                  <span class="usage-label">Firestore Database</span>
                  <span class="usage-details">{{ formatBytes(stats.firestoreUsedBytes!) }} / {{ formatBytes(stats.firestoreLimitBytes!) }}</span>
                </div>
                <ion-chip [color]="(stats.firestorePercentUsed ?? 0) >= 80 ? 'warning' : 'primary'" size="small">
                  <ion-label>{{ (stats.firestorePercentUsed ?? 0) | number:'1.0-0' }}%</ion-label>
                </ion-chip>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar-fill" [style.width.%]="capPercentage(stats.firestorePercentUsed)" [class.warning]="(stats.firestorePercentUsed ?? 0) >= 80" [class.danger]="(stats.firestorePercentUsed ?? 0) >= 95"></div>
              </div>
              <div class="usage-footer">
                <span class="usage-free-tier">Free tier: {{ formatBytes(stats.firestoreLimitBytes!) }}</span>
              </div>
            </div>

            <!-- Combined Usage (if Firestore is available) -->
            <div class="usage-item combined-usage" *ngIf="stats.combinedUsedBytes !== null">
              <div class="usage-header">
                <div class="usage-info">
                  <span class="usage-label">Combined Usage</span>
                  <span class="usage-details">{{ formatBytes(stats.combinedUsedBytes!) }} / {{ formatBytes(stats.combinedLimitBytes!) }}</span>
                </div>
                <ion-chip [color]="(stats.combinedPercentUsed ?? 0) >= 80 ? 'warning' : 'primary'" size="small">
                  <ion-label>{{ (stats.combinedPercentUsed ?? 0) | number:'1.0-0' }}%</ion-label>
                </ion-chip>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar-fill" [style.width.%]="capPercentage(stats.combinedPercentUsed)" [class.warning]="(stats.combinedPercentUsed ?? 0) >= 80" [class.danger]="(stats.combinedPercentUsed ?? 0) >= 95"></div>
              </div>
              <div class="usage-footer">
                <span class="usage-free-tier">Total free tier: {{ formatBytes(stats.combinedLimitBytes!) }}</span>
              </div>
            </div>

            <!-- Loading state for Firestore -->
            <div class="usage-item" *ngIf="stats.firestoreUsedBytes === null && stats.storageUsedBytes > 0">
              <div class="usage-loading">
                <ion-icon name="hourglass-outline"></ion-icon>
                <span>Calculating Firestore usage...</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- System Status -->
      <!-- <div class="content-card">
        <div class="card-header">
          <ion-icon name="server-outline"></ion-icon>
          <h3>System Status</h3>
        </div>
        <div class="card-content">
          <div class="status-list">
            <div class="status-item">
              <div class="status-indicator"
                   [ngClass]="{
                     'success': stats.databaseConnection === 'online',
                     'warning': stats.databaseConnection === 'checking',
                     'danger': stats.databaseConnection === 'offline'
                   }"></div>
              <span>Database Connection</span>
              <ion-chip [color]="stats.databaseConnection === 'online' ? 'success' : (stats.databaseConnection === 'checking' ? 'warning' : 'danger')" size="small">
                <ion-label>
                  {{ stats.databaseConnection === 'online' ? 'Online' : (stats.databaseConnection === 'checking' ? 'Checking...' : 'Offline') }}
                </ion-label>
              </ion-chip>
            </div>
            <div class="status-item">
              <div class="status-indicator"
                   [ngClass]="{
                     'success': stats.emailService === 'active',
                     'warning': stats.emailService === 'checking',
                     'danger': stats.emailService === 'inactive'
                   }"></div>
              <span>Email Service</span>
              <ion-chip [color]="stats.emailService === 'active' ? 'success' : (stats.emailService === 'checking' ? 'warning' : 'danger')" size="small">
                <ion-label>
                  {{ stats.emailService === 'active' ? 'Active' : (stats.emailService === 'checking' ? 'Checking...' : 'Inactive') }}
                </ion-label>
              </ion-chip>
            </div>
            <div class="status-item" [class.warning-text]="stats.storagePercentUsed >= 80">
              <div class="status-indicator" [ngClass]="stats.storagePercentUsed >= 80 ? 'warning' : 'success'"></div>
              <span>
                Storage Usage
                ({{ formatBytes(stats.storageUsedBytes) }} / {{ (stats.storageLimitBytes / (1024 * 1024 * 1024)) | number:'1.1-1' }} GB)
              </span>
              <ion-chip [color]="stats.storagePercentUsed >= 80 ? 'warning' : 'primary'" size="small">
                <ion-label>{{ stats.storagePercentUsed | number:'1.0-0' }}%</ion-label>
              </ion-chip>
            </div>
            <div class="status-item">
              <div class="status-indicator"
                   [ngClass]="{
                     'success': stats.sslCertificate === 'valid',
                     'warning': stats.sslCertificate === 'checking' || stats.sslCertificate === 'expiring',
                     'danger': stats.sslCertificate === 'invalid'
                   }"></div>
              <span>SSL Certificate</span>
              <ion-chip [color]="stats.sslCertificate === 'valid' ? 'success' : (stats.sslCertificate === 'checking' ? 'warning' : (stats.sslCertificate === 'expiring' ? 'warning' : 'danger'))" size="small">
                <ion-label>
                  {{ stats.sslCertificate === 'valid' ? 'Valid' : (stats.sslCertificate === 'checking' ? 'Checking...' : (stats.sslCertificate === 'expiring' ? 'Expiring' : 'Invalid')) }}
                </ion-label>
              </ion-chip>
            </div>
          </div>
        </div>
      </div> -->

      <!-- Security Alerts -->
      <!-- <div class="content-card">
        <div class="card-header">
          <ion-icon name="shield-outline"></ion-icon>
          <h3>Security Center</h3>
        </div>
        <div class="card-content">
          <div class="security-info">
            <div class="security-item">
              <ion-icon name="checkmark-circle" color="success"></ion-icon>
              <div>
                <p><strong>Two-Factor Authentication</strong></p>
                <p>Enabled for admin accounts</p>
              </div>
            </div>
            <div class="security-item">
              <ion-icon name="checkmark-circle" color="success"></ion-icon>
              <div>
                <p><strong>Email Verification</strong></p>
                <p>Required for all accounts</p>
              </div>
            </div>
            <div class="security-item">
              <ion-icon name="checkmark-circle" color="success"></ion-icon>
              <div>
                <p><strong>Input Sanitization</strong></p>
                <p>Active protection against XSS</p>
              </div>
            </div>
          </div>
          <ion-button expand="block" fill="outline" class="security-btn">
            <ion-icon name="settings-outline" slot="start"></ion-icon>
            Security Settings
          </ion-button>
        </div>
      </div> -->
    </div>

    <!-- Footer Info -->
    <!-- <div class="dashboard-footer">
      <div class="footer-content">
        <p>Last login: {{ currentUser?.lastLoginAt | date:'medium' }}</p>
        <p>Session expires in: 2 hours</p>
      </div>
    </div> -->
  </div>
</ion-content>
